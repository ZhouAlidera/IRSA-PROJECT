{% extends 'base_tailwind.html' %}
{% block content %}

<div class="min-h-[90vh] bg-[#f8fafc] flex items-center justify-center px-4 py-12">
    <div class="w-full max-w-5xl bg-white rounded-[2.5rem] shadow-[0_40px_100px_-20px_rgba(0,0,0,0.05)] overflow-hidden flex min-h-[650px] border border-slate-100 animate-fade-in">
        
        <div class="w-full md:w-1/2 p-10 md:p-16 flex flex-col justify-center">
            
            <div class="mb-10">
                <div class="flex items-center gap-2 mb-4">
                    <span class="w-6 h-1 bg-[#2D8B8B] rounded-full"></span>
                    <span class="text-[10px] font-black uppercase tracking-[0.3em] text-[#2D8B8B]">Étape 01/02</span>
                </div>
                <h2 class="text-3xl font-black text-slate-900 tracking-tighter uppercase italic">Identification <span class="text-[#2D8B8B]">DGI</span></h2>
                <p class="text-slate-400 font-bold text-xs uppercase tracking-widest mt-2">Relier votre établissement via le NIF</p>
            </div>

            <form method="post" id="regForm1" class="space-y-6">
                {% csrf_token %}
                
                <div class="space-y-2 group">
                    <label class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 ml-1">Numéro d'Identification Fiscale</label>
                    <div class="relative">
                        <input type="text" name="nif" id="nif_input" required placeholder="0000000000"
                               class="w-full px-6 py-4 rounded-2xl border-2 border-slate-50 bg-slate-50/50 focus:bg-white focus:outline-none focus:border-[#2D8B8B] transition-all font-black text-slate-700 tracking-[0.2em] shadow-sm placeholder:text-slate-300" />
                        
                        <div class="absolute right-4 top-1/2 -translate-y-1/2">
                            <div id="nif_loader" class="hidden animate-spin h-5 w-5 border-2 border-[#2D8B8B] border-t-transparent rounded-full"></div>
                            <div id="nif_success" class="hidden text-emerald-500">
                                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            </div>
                        </div>
                    </div>
                    <p id="nif_error" class="hidden text-[9px] font-bold text-rose-500 uppercase tracking-tighter italic">NIF invalide ou introuvable dans la base fiscale.</p>
                </div>

                <div class="space-y-2 opacity-50 transition-opacity duration-500" id="raison_container">
                    <label class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 ml-1">Raison Sociale détectée</label>
                    <input type="text" name="raison_sociale" id="raison_input" readonly
                           class="w-full px-6 py-4 rounded-2xl bg-slate-100 border-none font-black text-slate-800 italic uppercase text-xs cursor-not-allowed" placeholder="---" />
                </div>

                <div class="flex flex-col gap-4 pt-6">
                    <button type="submit" id="submit_btn" disabled 
                            class="w-full py-4 bg-slate-200 text-slate-400 rounded-2xl transition-all duration-300 font-black uppercase text-[11px] tracking-[0.2em] flex items-center justify-center gap-3 cursor-not-allowed">
                        Continuer l'inscription
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                    </button>
                    
                    <a href="{% url 'login' %}" class="text-center text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-[#2D8B8B] transition-colors">
                        Déjà inscrit ? Se connecter
                    </a>
                </div>
            </form>
        </div>

        <div class="hidden md:flex w-1/2 bg-[#2D8B8B] relative overflow-hidden items-center justify-center p-16">
            <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"></div>
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-emerald-900/20 rounded-full -ml-32 -mb-32 blur-3xl"></div>
            
            <div class="relative z-10 text-center">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-white/10 backdrop-blur-md rounded-3xl border border-white/20 mb-8 shadow-2xl">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-black text-white uppercase italic tracking-tighter leading-tight">Portail de Télédéclaration <br><span class="text-emerald-300">IRSA Madagascar</span></h3>
                <div class="w-12 h-1 bg-white/20 mx-auto my-6 rounded-full"></div>
                <p class="text-emerald-100/60 font-bold uppercase tracking-[0.2em] text-[9px] max-w-xs mx-auto leading-relaxed">
                    Accès sécurisé réservé aux employeurs immatriculés auprès de la Direction Générale des Impôts.
                </p>
            </div>
            
            <div class="absolute bottom-8 flex items-center gap-3">
                <div class="w-1 h-8 bg-white/20"></div>
                <p class="text-[8px] font-black text-white/40 uppercase tracking-[0.4em] text-left">Ministère de l'Économie<br>et des Finances</p>
            </div>
        </div>
    </div>
</div>

<style>
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const nifInput = document.getElementById('nif_input');
    const raisonInput = document.getElementById('raison_input');
    const raisonContainer = document.getElementById('raison_container');
    const submitBtn = document.getElementById('submit_btn');
    const nifLoader = document.getElementById('nif_loader');
    const nifSuccess = document.getElementById('nif_success');
    const nifError = document.getElementById('nif_error');

    nifInput.addEventListener('input', function() {
        if(this.value.length >= 10) { // Longueur standard NIF
            nifLoader.classList.remove('hidden');
            nifError.classList.add('hidden');
            nifSuccess.classList.add('hidden');

            // Simulation d'appel API
            setTimeout(() => {
                nifLoader.classList.add('hidden');
                // ICI: Remplacer par ton vrai fetch
                const mockFound = true; 

                if (mockFound) {
                    raisonInput.value = "ENTREPRISE EXEMPLE SARL";
                    raisonContainer.classList.remove('opacity-50');
                    nifSuccess.classList.remove('hidden');
                    
                    // Activation du bouton
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('bg-slate-200', 'text-slate-400', 'cursor-not-allowed');
                    submitBtn.classList.add('bg-[#2D8B8B]', 'text-white', 'hover:bg-emerald-600', 'shadow-lg', 'shadow-emerald-900/20');
                } else {
                    nifError.classList.remove('hidden');
                    resetState();
                }
            }, 800);
        } else {
            resetState();
        }
    });

    function resetState() {
        submitBtn.disabled = true;
        submitBtn.classList.add('bg-slate-200', 'text-slate-400', 'cursor-not-allowed');
        submitBtn.classList.remove('bg-[#2D8B8B]', 'text-white', 'hover:bg-emerald-600', 'shadow-lg');
        raisonInput.value = "---";
        raisonContainer.classList.add('opacity-50');
        nifSuccess.classList.add('hidden');
    }
});
</script>
{% endblock %}